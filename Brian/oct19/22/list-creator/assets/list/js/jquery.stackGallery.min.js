(function(h){h.fn.stackGallery=function(C){function La(a){var b=a*Math.PI/180;a=Math.cos(b);var b=Math.sin(b),c=v,f=w;V=Math.round(c*Math.abs(a)+f*Math.abs(b));W=Math.round(c*Math.abs(b)+f*Math.abs(a));ua=W-w;va=V-v}function Ma(a,b,c){a=a*Math.PI/180;var f=Math.cos(a),e=Math.sin(a);a=f*b;var d=e*b,g=-e*c,k=f*c,h=f*b-e*c;c=e*b+f*c;b=Math.min(0,d,k,c);c=Math.max(0,d,k,c);wa=Math.round(Math.max(0,a,g,h)-Math.min(0,a,g,h));xa=Math.round(c-b)}function fa(){var a=0,b,c,f,e;q&&La(N);var d=p("w"),g=p("h");
for(a;a<m;a++){b=h(l[a]);c=b.find("div[class=scaler]");if(ya||I>d||J>g||V>d||W>g){if(q){if(e={},e.width=g/(w+ua)*v,e.height=g,Ma(N,e.width,e.width*y),K="width",wa-1>d||xa-1>g)e.height=d/(v+va)*w,e.width=d,K="height"}else e=za(O,v,w,!0);f=e.width;e=e.height}else f=v,e=w;if(!ieBelow9)b&&("width"==K?(b.width(f),b.height(f*y)):(b.height(e),b.width(e*L))),c&&("width"==K?(c.width(f-2*B),c.height(b.width()*y-2*B)):(c.height(e-2*B),c.width(b.height()*L-2*B)));else if(ya||I>d||J>g||V>d||W>g||b.width()<I||
b.height()<J)b&&("width"==K?(b.width(f),b.height(f*y)):(b.height(e),b.width(e*L))),c&&("width"==K?(c.width(f-2*B),c.height(b.width()*y-2*B)):(c.height(e-2*B),c.width(b.height()*L-2*B)))}q?"width"==K?D.css({left:"50%",top:"50%",width:f+"px",height:b.width()*y+"px",marginLeft:-f/2+"px",marginTop:-(b.width()*y)/2+"px"}):D.css({left:"50%",top:"50%",height:e+"px",width:b.height()*L+"px",marginLeft:-(b.height()*L)/2+"px",marginTop:-(b.width()*y)/2+"px"}):D.css({left:"50%",top:"50%",width:f+"px",height:b.width()*
y+"px",marginLeft:-f/2-(X+Y)/2+"px",marginTop:-(b.width()*y)/2-(Z+aa)/2+"px"});t&&("rightCenter"==Aa?(a=p("w")/2+D.width()/2+t.width(),a>p("w")-t.width()-20&&(a=p("w")-t.width()-20),t.css("left",a+"px")):"topCenter"==Aa&&(a=p("h")/2-D.height()/2-t.height()-10,10>a&&(a=10),t.css("top",a+"px")));a=0;b=ga.length;var k;for(a;a<b;a++)c=h(ga[a]),c.find("div[data-type=caption]").each(function(){k=h(this);k.removeClass("caption_font_small").removeClass("caption_font_medium").removeClass("caption_font_large");
570>=p("w")||320>=p("h")?k.addClass("caption_font_small"):767>=p("w")||570>=p("h")?k.addClass("caption_font_medium"):(959>=p("w")||767>=p("h"))&&k.addClass("caption_font_large")});if(q&&ieBelow9)for(a=0;a<m;a++)div=h(l[a]),a!=m-1&&div.css({rotate:Ba[a]+"deg"})}function za(a,b,c,f){a={};var e=p("w")-(I-v),d=p("h")-(J-w),g=(e-0)/(d-0),k=b/c;k<g?f?(a.width=(d-0)/c*b,a.height=d-0):(a.height=(e-0)/b*c,a.width=e-0):k>g?f?(a.height=(e-0)/b*c,a.width=e-0):(a.width=(d-0)/c*b,a.height=d-0):(a.width=e-0,a.height=
d-0);return a}function za(a,b,c,f){a={};var e=0,d=0,g=p("w")-(I-v),k=p("h")-(J-w),h=(g-e)/(k-d),l=b/c;l<h?f?(a.width=(k-d)/c*b,a.height=k-d):(a.height=(g-e)/b*c,a.width=g-e):l>h?f?(a.height=(g-e)/b*c,a.width=g-e):(a.width=(k-d)/c*b,a.height=k-d):(a.width=g-e,a.height=k-d);return a}function Ca(){var a=h(l[0]);q?(E=a.outerHeight()+100,P=a.outerWidth()+50):(E=a.outerHeight()+10,P=a.outerWidth()+5)}function ba(a,b){var c=m-1,f=parseInt(h(l[c]).attr("data-orig-id"),10);beforeSlideChange(f);void 0!=l[c].data("captionSubArr")&&
Da(c);var e;e=a?b?h(ha(a)):h(ia(a)):h(ia(c));var d=10*Math.random()+-25,g=Math.random()*(ca-M)+M,k=0,n=0;Ca();if("verticalAbove"==A||"verticalRound"==A)q?isSafari?e.animate({top:-E+"px"},{duration:500,easing:"easeOutSine",step:function(a,b){n=Math.round(500*a/E);k=-(n*d/500);setTimeout(function(){e.css("-webkit-transform","rotate("+k+"deg)")},65)},complete:function(){ja(e,g,k,a,b)}}):e.animate({rotate:d+"deg",top:-E+"px"},{duration:500,easing:"easeOutCubic",complete:function(){ja(e,g,k,a,b)}}):e.animate({top:-E+
"px"},{duration:500,easing:"easeOutCubic",complete:function(){ja(e,g,k,a,b)}});else{var z="horizontalLeft"==A?-P:P;q?isSafari?e.animate({left:z+"px"},{duration:500,easing:"easeOutSine",step:function(a,b){n=Math.round(500*a/z);k="horizontalLeft"==A?n*d/500:-(n*d/500);setTimeout(function(){e.css("-webkit-transform","rotate("+k+"deg)")},65)},complete:function(){ka(e,g,k,a,b)}}):e.animate({rotate:d+"deg",left:z+"px"},{duration:500,easing:"easeOutCubic",complete:function(){ka(e,g,k,a,b)}}):e.animate({left:z+
"px"},{duration:500,easing:"easeOutCubic",complete:function(){ka(e,g,k,a,b)}})}}function ja(a,b,c,f,e){f?(e&&(f=h(ha(f)).attr("data-id")),e=l[f],l.splice(f,1),l.push(e)):l.unshift(l.pop());Ea();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));e=b;if(q)if(isSafari){var d,g,k=0,n=0,z,p=parseInt(a.css("top"),10);f&&(b=0);0>c&&0>b&&c>b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="-"):0<c&&0<b&&c>b?(d=c-b,g="-"):0<c&&0>b?(d=c+Math.abs(b),g="-"):0>c&&0>b&&c<b?(d=Math.abs(Math.abs(c)-Math.abs(b)),
g="+"):0<c&&0<b&&c<b?(d=b-c,g="+"):0>c&&0<b?(d=Math.abs(c)+b,g="+"):0==c&&0<b?(d=b,g="+"):0<c&&0==b?(d=c,g="-"):0>c&&0==b?(d=Math.abs(c),g="+"):0==c&&0>b&&(d=Math.abs(b),g="-");a.animate({top:"0px"},{duration:500,easing:"easeOutSine",step:function(b,e){n=-Math.round(500*b/p-500);k=n*d/500;setTimeout(function(){z="+"==g?c+k:c-k;a.css("-webkit-transform","rotate("+z+"deg)")},65)}})}else f?a.animate({rotate:"0deg",top:"0px"},{duration:500,easing:"easeOutExpo"}):a.animate({rotate:b+"deg",top:"0px"},{duration:500,
easing:"easeOutExpo"});else b=0,void 0!=a.data("origTop")&&(b=parseInt(a.data("origTop"),10)),a.animate({top:b+"px"},{duration:500,easing:"easeOutExpo"});q&&(f?h(l[m-2]).animate({rotate:e+"deg",duration:500,easing:"easeOutSine"}):h(l[m-1]).animate({rotate:"0deg",duration:500,easing:"easeOutExpo"}));F&&clearTimeout(F);F=setTimeout(Fa,500)}function ka(a,b,c,f,e){f?(e&&(f=h(ha(f)).attr("data-id")),e=l[f],l.splice(f,1),l.push(e)):l.unshift(l.pop());Ea();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),
10));e=b;if(q)if(isSafari){var d,g,k=0,n=0,z,p=parseInt(a.css("left"),10);f&&(b=0);0>c&&0>b&&c>b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="-"):0<c&&0<b&&c>b?(d=c-b,g="-"):0<c&&0>b?(d=c+Math.abs(b),g="-"):0>c&&0>b&&c<b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="+"):0<c&&0<b&&c<b?(d=b-c,g="+"):0>c&&0<b?(d=Math.abs(c)+b,g="+"):0==c&&0<b?(d=b,g="+"):0<c&&0==b?(d=c,g="-"):0>c&&0==b?(d=Math.abs(c),g="+"):0==c&&0>b&&(d=Math.abs(b),g="-");a.animate({left:"0px"},{duration:500,easing:"easeOutSine",step:function(b,
e){n=-Math.round(500*b/p-500);k=n*d/500;setTimeout(function(){z="+"==g?c+k:c-k;a.css("-webkit-transform","rotate("+z+"deg)")},65)}})}else f?a.animate({rotate:"0deg",left:"0px"},{duration:500,easing:"easeOutExpo"}):a.animate({rotate:b+"deg",left:"0px"},{duration:500,easing:"easeOutExpo"});else b=0,void 0!=a.data("origLeft")&&(b=parseInt(a.data("origLeft"),10)),a.animate({left:b+"px"},{duration:500,easing:"easeOutExpo"});q&&(f?h(l[m-2]).animate({rotate:e+"deg",duration:500,easing:"easeOutSine"}):h(l[m-
1]).animate({rotate:"0deg",duration:500,easing:"easeOutExpo"}));F&&clearTimeout(F);F=setTimeout(Fa,500)}function Ga(){var a=h(l[m-1]).attr("data-id"),b=parseInt(h(l[a]).attr("data-orig-id"),10);beforeSlideChange(b);void 0!=l[a].data("captionSubArr")&&Da(a);var c=h(ia(0)),f=10*Math.random()+-25,e=Math.random()*(ca-M)+M,d=0,g=0;Ca();if("verticalAbove"==A||"verticalRound"==A){var k="verticalRound"==A?E:-E;q?isSafari?c.animate({top:k+"px"},{duration:500,easing:"easeOutSine",step:function(a,b){g=Math.round(500*
a/k);d="verticalRound"==A?-(g*f/500):g*f/500;setTimeout(function(){c.css("-webkit-transform","rotate("+d+"deg)")},65)},complete:function(){la(c,e,d)}}):c.animate({rotate:f+"deg",top:k+"px"},{duration:500,easing:"easeOutCubic",complete:function(){la(c,e)}}):c.animate({top:k+"px"},{duration:500,easing:"easeOutCubic",complete:function(){la(c)}})}else{var n="horizontalLeft"==A?-P:P;q?isSafari?c.animate({left:n+"px"},{duration:500,easing:"easeOutSine",step:function(a,b){g=Math.round(500*a/n);d="horizontalLeft"==
A?-(g*f/500):g*f/500;setTimeout(function(){c.css("-webkit-transform","rotate("+d+"deg)")},65)},complete:function(){ma(c,e,d)}}):c.animate({rotate:f+"deg",left:n+"px"},{duration:500,easing:"easeOutCubic",complete:function(){ma(c,e)}}):c.animate({left:n+"px"},{duration:500,easing:"easeOutCubic",complete:function(){ma(c)}})}}function la(a,b,c){l.push(l.shift());Ha();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));if(q)if(h(l[m-2]).animate({rotate:b+"deg",duration:500,easing:"easeOutSine"}),
isSafari){var f=Math.abs(c),e,d=0,g=0,k,n=parseInt(a.css("top"),10);0<c?e="-":0>c&&(e="+");a.animate({top:"0px"},{duration:500,easing:"easeOutSine",step:function(b,h){g=-Math.round(500*b/n-500);d=g*f/500;setTimeout(function(){k="+"==e?Math.floor(c+d):Math.floor(c-d);a.css("-webkit-transform","rotate("+k+"deg)")},65)},complete:function(){G(a.attr("data-id"))}})}else a.animate({rotate:"0deg",top:"0px"},{duration:500,easing:"easeOutExpo",complete:function(){G(a.attr("data-id"))}});else b=0,void 0!=a.data("origTop")&&
(b=parseInt(a.data("origTop"),10)),a.animate({top:b+"px"},{duration:500,easing:"easeOutExpo",complete:function(){G(a.attr("data-id"))}})}function ma(a,b,c){l.push(l.shift());Ha();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));if(q)if(h(l[m-2]).animate({rotate:b+"deg",duration:500,easing:"easeOutSine"}),isSafari){var f=Math.abs(c),e,d=0,g=0,k,n=parseInt(a.css("left"),10);0<c?e="-":0>c&&(e="+");a.animate({left:"0px"},{duration:500,easing:"easeOutSine",step:function(b,h){g=-Math.round(500*
b/n-500);d=g*f/500;setTimeout(function(){k="+"==e?Math.floor(c+d):Math.floor(c-d);a.css("-webkit-transform","rotate("+k+"deg)")},65)},complete:function(){G(a.attr("data-id"))}})}else a.animate({rotate:"0deg",left:"0px"},{duration:500,easing:"easeOutExpo",complete:function(){G(a.attr("data-id"))}});else b=0,void 0!=a.data("origLeft")&&(b=parseInt(a.data("origLeft"),10)),a.animate({left:b+"px"},{duration:500,easing:"easeOutExpo",complete:function(){G(a.attr("data-id"))}})}function Da(a){var b=0,c=l[a].data("captionSubArr"),
f=l[a].data("caption_list");a=c.length;var e;for(b;b<a;b++)e=h(c[b]),b!=a-1?e.stop().animate({opacity:0},{duration:500,easing:"easeOutQuint"}):e.stop().animate({opacity:0},{duration:500,easing:"easeOutQuint",complete:function(){f.css("display","none")}})}function G(a){var b=parseInt(h(l[a]).attr("data-orig-id"),10);afterSlideChange(b);if(void 0!=l[a].data("captionSubArr")){var b=0,c=l[a].data("captionSubArr"),f=l[a].data("caption_list");a=c.length;f.css("display","block");for(b;b<a;b++)f=h(c[b]),
f.css("opacity",0),f.css("left","-100px"),b!=a-1?f.delay(150*b).animate({opacity:1,left:"0px"},{duration:500,easing:"easeOutQuart"}):b==a-1&&f.delay(150*b).animate({opacity:1,left:"0px"},{duration:500,easing:"easeOutQuart",complete:function(){T("on");r=!1;u&&!da&&Q()}})}else T("on"),r=!1,u&&!da&&Q()}function p(a){return"w"==a?O.width():O.height()}function Fa(){F&&clearTimeout(F);G(h(l[m-1]).attr("data-id"))}function ea(){U&&clearTimeout(U);H.find("img").attr("src",path.img+"data/icons/play.png")}function Q(){U&&
clearTimeout(U);U=setTimeout(Na,Ia);H.find("img").attr("src",path.img+"data/icons/pause.png")}function Na(){r=!0;T("off");"forward"==Ja?ba():Ga()}function T(a){"on"==a?(R.css("cursor","pointer"),S.css("cursor","pointer")):(R.css("cursor","default"),S.css("cursor","default"))}function na(){r=!0;T("off");Ga()}function oa(){r=!0;T("off");ba()}function pa(a){if(!x)return!1;a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();a=h(a.currentTarget).attr("class");if("controls_previous"==a){if(r)return;
na()}else if("controls_toggle"==a)Ka();else if("controls_next"==a){if(r)return;oa()}return!1}function qa(a){if(!x)return!1;a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();var b=a.currentTarget;a=h(b).attr("class");b=h(b).find("img");"controls_previous"==a?b.attr("src",path.img+"data/icons/prev_on.png"):"controls_toggle"==a?u?b.attr("src",path.img+"data/icons/pause_on.png"):b.attr("src",path.img+"data/icons/play_on.png"):"controls_next"==a&&b.attr("src",path.img+"data/icons/next_on.png");return!1}function ra(a){if(!x)return!1;
a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();var b=a.currentTarget;a=h(b).attr("class");b=h(b).find("img");"controls_previous"==a?b.attr("src",path.img+"data/icons/prev.png"):"controls_toggle"==a?u?b.attr("src",path.img+"data/icons/pause.png"):b.attr("src",path.img+"data/icons/play.png"):"controls_next"==a&&b.attr("src",path.img+"data/icons/next.png");return!1}function ia(a){var b=0,c,f;for(b;b<m&&(c=h(l[b]),f=c.attr("data-id"),f!=a);b++);return c}function ha(a){var b=0,c,f;for(b;b<m&&(c=h(l[b]),f=c.attr("data-orig-id"),
f!=a);b++);return c}function Ea(){var a=0,b;for(a;a<m;a++)b=h(l[a]),b.attr("data-id",a),b.css("zIndex",a+1)}function Ha(){var a=0,b;for(a;a<m;a++)b=h(l[a]),b.attr("data-id",a),b.css("zIndex",a+1)}function Oa(a,b){for(var c=a.length;c--;)if(parseInt(a[c],10)===b)return!0;return!1}function Ka(){u?(ea(),u=!1):(u=!0,r||Q())}var x=!1,Pa=jQuery(window),Ba=[];isChrome&&(isIE=!0);var O=h(this),D=O.find(".componentPlaylist");D.css("zIndex",0);var u=C.slideshowOn,Ia=C.slideshowDelay,U,ya=C.fullSize,Aa=C.controlsAlignment,
Qa=C.swipeOn.split(","),y,L,B,N=0,K="width",ga=[],sa,l=[],q=C.useRotation,r=!1,F,m,ta=!1,v,w,I,J,V,W,wa,xa,Z=0,X=0,aa=500,Y=500,M=10,ca=-10,ua=0,va=0,A=C.slideshowLayout,Ja=C.slideshowDirection,E,P,t=O.find(".componentControls"),R=t.find(".controls_previous"),H=t.find(".controls_toggle"),S=t.find(".controls_next");R.css("cursor","pointer");H.css("cursor","pointer");S.css("cursor","pointer");R.bind("click touchstart",pa);H.bind("click touchstart",pa);S.bind("click touchstart",pa);R.bind("mouseover",
qa);H.bind("mouseover",qa);S.bind("mouseover",qa);R.bind("mouseout",ra);H.bind("mouseout",ra);S.bind("mouseout",ra);u?H.find("img").attr("src",path.img+"data/icons/pause.png"):H.find("img").attr("src",path.img+"data/icons/play.png");var da=!1;D.mouseenter(function(a){da=!0;u&&ea()}).mouseleave(function(){da=!1;r||!u||ta||Q()});Pa.resize(function(){if(!x)return!1;sa&&clearTimeout(sa);sa=setTimeout(fa,25)});(function(){var a,b,c,f,e,d,g=0;d=D.find("div[class=slide]");var k,n;m=d.length;d.each(function(){l.push(h(this))});
a=h(l[0]);v=a.width();w=a.height();y=w/v;L=v/w;d=a.find("div[class=scaler]");d.height();d.width();B=(a.width()-d.width())/2;for(g;g<m;g++){d=h(l[g]);d.attr("data-id",g);d.attr("data-orig-id",g);d.css("zIndex",g+1);q?(a=Math.random()*(ca-M)+M,Math.abs(a)>N&&(N=Math.abs(a),k=Math.abs(a),n=g),ieBelow9?Ba.push(a):g!=m-1&&d.css({rotate:a+"deg"})):(a=35*Math.random(),b=25*Math.random(),a>Z&&(Z=a),b>X&&(X=b),a<aa&&(aa=a),b<Y&&(Y=b),d.css("top",a+"px"),d.css("left",b+"px"),d.data("origTop",a),d.data("origLeft",
b));d.find("a[class=pp_content]").bind("click",function(){ta=!0;u&&ea();detailActivated();return!1}).bind("mouseover",function(){h(this).find("img").attr("src",path.img+"data/icons/detail_on.png");return!1}).bind("mouseout",function(){h(this).find("img").attr("src",path.img+"data/icons/detail.png");return!1});d.find("a[class=pp_link]").bind("mouseover",function(){h(this).find("img").attr("src",path.img+"data/icons/link_on.png");return!1}).bind("mouseout",function(){h(this).find("img").attr("src",path.img+"data/icons/link.png");return!1});
Oa(Qa,g)&&d.swipe({swipe:function(a,b){if(!x)return!1;"right"==b?na():"left"==b&&oa()}});j=0;f=d.find("div[class=caption_list]");ga.push(f);a=f.find("div[data-type=caption]");b=a.length;c=[];for(j;j<b;j++)e=a.eq(j),e.css("opacity",0),c.push(e);0<b&&(d.data("caption_list",f),d.data("captionSubArr",c));d.css("opacity",0);d.stop().animate({opacity:1},{duration:1E3,easing:"easeOutSine"})}M=N;ca=-N;q?(d=h(l[n]),d.data("max_rot",k),I=v,J=w):(I=X+v-Y,J=Z+w-aa);ieBelow9||fa();G(m-1);O.css("opacity",1);t&&
(t.css("opacity",0),t.css("display","block"),t.stop().animate({opacity:1},{duration:1E3,easing:"easeOutSine"}));x=!0;stackGalleryReady();ieBelow9&&fa()})();this.checkSlideshow2=function(){ta=!1;u&&(r||Q());detailClosed()};this.toggleSlideshow=function(a){x&&(void 0==a?Ka():a?(u=!0,r||Q()):(ea(),u=!1))};this.toggleDirection=function(a){!x||"forward"!=a&&"backward"!=a||(Ja=a)};this.setSlideshowDelay=function(a){x&&(Ia=a)};this.nextMedia=function(){x&&(r||oa())};this.previousMedia=function(){x&&(r||
na())};this.openMedia=function(a){x&&!r&&(0>a?a=0:a>m-1&&(a=m-1),h(l[m-1]).attr("data-id")!=a&&ba(a,!1))};this.openOriginalMedia=function(a){x&&!r&&(0>a?a=0:a>m-1&&(a=m-1),h(l[m-1]).attr("data-orig-id")!=a&&ba(a,!0))};return this}})(jQuery);